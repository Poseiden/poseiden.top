---
title: OAuth2.0 之授权码的奥秘
tags:
---
## 缘起
鉴权和授权是我们日常开发经常见到的老朋友。在授权中，"OAuth2.0"是一个常见概念，是很多传统企业，第三方APP在处理客户端授权时参考采用的标准。在现如今，搜索引擎中随便一搜关于 OAuth2.0 的关键词，相关文章讲解的文章都洋洋洒洒一大片。
（图）
所以本文自然也不是来炒冷饭的。最初当我查阅有关OAuth的资料时，发现这些网上这些文章多数是在讲解“是什么”或是“怎么用”，而很少有人关注到OAuth的设计意图。而我为何会提出这点呢，原因是当我在了解OAuth2.0的授权模式时，对于其中的授权码模式总是含糊不清，因为授权码模式在四个模式中功能最完整，流程最复杂（相对来说），而对比其他三种，大脑总是倾向于记住那些简单易懂的。而在我想通过了解设计思路以及意图来加深对它的理解时，发现除了原论文以外，可参考的文档寥寥无几。这让我在搞清楚问题之余，萌生出了写下这篇文章的念头。不仅记录思维，也可以供后面大家的参考讨论。
<!-- 二来很奇怪授权码模式(authorization code)中的优势在哪里？对比同门师兄弟客户端模式(client credentials)，不如认证服务器直接返回访问令牌来的更为直接。 -->
<!-- 说到这，就不得不说OAuth中的Auth了。大家都知道，Auth是Authorization的缩写，即授权。 -->

哦，对了，本文不会再对授权模式中的“简化模式（Implicit Flow）”和“密码模式（Password Grant）”赘述, 因为在 OAuth 官网，这两者皆已被标注为“Legacy”。
（图）
<!--more-->
## OAuth
好，现在让我们回到问题本身。不知道大家在看授权模式时是否曾经跟我有一样的疑惑，简单来说，对于授权码模式，既然是授权服务器先给予客户端一个授权码，客户端拿着授权码再回头向授权服务器申请一个访问令牌。那为什么不直接设计成，在用户选择同意授权之后，授权服务器直接将令牌返回给客户端？反而中间需要一个“授权码”来做一次“翻译”？多了一次交互的成本。从这方面来看，效果可能还不如客户端模式（client credentials）来的直接。
对于这个问题，如大家所知，OAuth设计出来就是是用于解决授权问题的，并且安全是很重要的一个点，很多问题从安全的角度出发去思考也就不难理解了。 
### Authorization Code Grant
首先，我们贴出这种模式的时序图。
（图）
如果我们按照刚才的思路所说，在第二步中返回令牌。
### Client Credentials Grant
## 适用范围
### SSO
## 后续
## Ref
- [OAuth 官方网站](https://oauth.net/)
- [理解OAuth 2.0 - 阮一峰](https://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html)
- [OAuth2.0入门（一）—— 基本概念详解和图文并茂讲解四种授权类型](https://blog.csdn.net/qq_37771475/article/details/103288957)
- [为什么OAuth2里面在获取access token之前一定要先获取code....](https://www.zhihu.com/question/27446826/answer/127367856)
